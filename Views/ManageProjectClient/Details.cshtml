@model Freelancing.Models.OngoingProjectViewModel
@{
    Layout = "_LayoutClient";
    ViewData["Title"] = "Project Details - " + Model.ProjectName;
}

<div class="p-4 sm:ml-64">
    <div class="p-4 mt-20">
        <div class="mt-4">
            <div class="block w-full p-6">
                <!-- Header -->
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center space-x-4">
                        <a href="@Url.Action("Index")" class="text-blue-600 hover:text-blue-800">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                            </svg>
                        </a>
                        <h1 class="text-3xl font-bold text-gray-900">@Model.ProjectName</h1>
                    </div>
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium @(ViewBag.ContractStatus == "Active" ? "bg-green-100 text-green-800" : ViewBag.ContractStatus == "Terminated" ? "bg-red-100 text-red-800" : ViewBag.ContractStatus == "Completed" ? "bg-blue-100 text-blue-800" : "bg-gray-100 text-gray-800")">
                        @ViewBag.ContractStatus
                    </span>
                </div>
                <!-- Success/Error Messages -->
                @if (ViewBag.Message != null)
                {
                    <div class="mt-2 flex items-center p-4 mb-4 text-sm text-green-800 border border-green-300 rounded-lg bg-green-50" role="alert">
                        <svg class="shrink-0 inline w-4 h-4 me-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5Zm3.707 8.207-4 4a1 1 0 0 1-1.414 0l-2-2a1 1 0 0 1 1.414-1.414L9 10.586l3.293-3.293a1 1 0 0 1 1.414 1.414Z" />
                        </svg>
                        <span class="sr-only">Success</span>
                        <div>
                            @ViewBag.Message
                        </div>
                    </div>
                }
                @if (ViewBag.ErrorMessage != null)
                {
                    <div class="mt-2 p-4 mb-4 text-sm text-red-800 border border-red-300 rounded-lg bg-red-50" role="alert">
                        <div class="flex items-center mb-2">
                            <svg class="shrink-0 inline w-4 h-4 me-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z" />
                            </svg>
                            <span class="font-medium">Edit failed!</span>
                        </div>

                        <ul class="list-disc list-inside space-y-1">
                            @foreach (var modelError in ViewData.ModelState.Values.SelectMany(v => v.Errors))
                            {
                                <li>@modelError.ErrorMessage</li>
                            }
                        </ul>
                    </div>
                }

                <!-- Project Info Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Project Details -->
                    <div class="col-span-2 w-full h-full">
                        <!-- Freelancer Profile -->
                        <div class="bg-white p-6">
                            <div class="flex items-center space-x-3 mb-2 ms-3">
                                <img src="@Model.FreelancerPhoto" alt="@Model.FreelancerName" class="w-24 h-24 rounded-full">
                                <div>
                                    <p class="font-medium text-gray-900 ms-1">@Model.FreelancerName <span class="italic text-sm font-light">(Freelancer)</span></p>
                                    <p class="text-sm text-gray-500 mb-2 ms-1">@Model.FreelancerEmail</p>
                                    @if (Model.FreelancerSkills.Any())
                                    {
                                        <div class="flex flex-wrap gap-1">
                                            @foreach (var skill in Model.FreelancerSkills.Take(5))
                                            {
                                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                                    @skill.Name
                                                </span>
                                            }
                                            @if (Model.FreelancerSkills.Count > 5)
                                            {
                                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                                                    +@(Model.FreelancerSkills.Count - 5) more
                                                </span>
                                            }
                                        </div>
                                    }
                                </div>
                            </div>
                            <button type="button" class="text-gray-900 bg-white border border-gray-300 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-100 font-medium rounded-lg text-sm px-5 py-2 me-2 mb-4" onclick="openProfileModal()">View Profile</button>

                            <!-- Required Skills -->
                            <h2 class="text-xl font-semibold text-gray-900 mb-2">Required Skills</h2>
                            @if (Model.ProjectRequiredSkills.Any())
                            {
                                <div class="flex flex-wrap gap-2 mb-6">
                                    @foreach (var skill in Model.ProjectRequiredSkills)
                                    {
                                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
                                            @skill.Name
                                        </span>
                                    }
                                </div>
                            }

                            <!-- Project Description -->
                            <h2 class="text-xl font-semibold text-gray-900 mb-2">Project Description</h2>
                            <p class="text-gray-700 leading-relaxed mb-6">@Model.ProjectDescription</p>

                            <!-- Accepted Proposal -->
                            <h2 class="text-xl font-semibold text-gray-900 mb-2">Accepted Proposal</h2>
                            <p class="text-gray-700 leading-relaxed mb-6">@Model.AcceptedBidProposal</p>

                            <!-- Project Images -->
                            @if (Model.ProjectImageUrls.Any())
                            {
                                <h2 class="text-xl font-semibold text-gray-900 mb-2">Posted Images</h2>
                                <div class="grid grid-cols-2 gap-2">
                                    @foreach (var imageUrl in Model.ProjectImageUrls.Take(4))
                                    {
                                        <img src="@imageUrl" alt="Project image" class="w-full h-20 object-cover rounded-md">
                                    }
                                </div>
                                @if (Model.ProjectImageUrls.Count > 4)
                                {
                                    <p class="text-sm text-gray-500 mt-2">+@(Model.ProjectImageUrls.Count - 4) more images</p>
                                }
                            }
                        </div>
                    </div>

                    <!-- Sidebar -->
                    <div class="space-y-3">
                        <!-- Project Summary -->
                        <div class="bg-white rounded-lg shadow p-6">
                            <h2 class="text-xl font-semibold text-gray-900 mb-4">Project Summary</h2>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-500">Accepted Amount:</span>
                                    <span class="font-medium text-green-600">â‚±@Model.AcceptedBidAmount</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-500">Category:</span>
                                    <span class="font-medium">@Model.ProjectCategory</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-500">Delivery:</span>
                                    <span class="font-medium">@Model.AcceptedBidDelivery</span>
                                </div>
                                @if (Model.BiddingAcceptedDate.HasValue)
                                {
                                    <div class="flex justify-between">
                                        <span class="text-gray-500">Start Date:</span>
                                        <span class="font-medium text-green-600">@Model.BiddingAcceptedDate.Value.ToString("MMM dd, yyyy")</span>
                                    </div>
                                }
                            </div>
                        </div>

                        @if (ViewBag.ContractStatus == "Terminated" || ViewBag.ContractStatus == "Completed")
                        {

                        }
                        else
                        {
                            <!-- Contract Status Section -->
                            @if (ViewBag.ContractId != null)
                            {
                                <div class="bg-white rounded-lg shadow p-4 mb-3 mt-3">
                                    <h3 class="text-lg font-semibold text-gray-900 mb-2">Contract Status</h3>
                                    @if (ViewBag.ContractStatus == "Active")
                                    {
                                        <div class="flex items-center text-green-600">
                                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                            </svg>
                                            <span class="font-medium">Contract Active</span>
                                        </div>
                                    }
                                    else if (ViewBag.NeedsSignature == true)
                                    {
                                        <div class="flex items-center text-orange-600">
                                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5">
                                                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                                                <g id="SVGRepo_iconCarrier">
                                                    <path d="M12 16.99V17M12 7V14M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                                </g>
                                            </svg>
                                            <span class="font-medium ms-2">Waiting for your signature</span>
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="flex items-center text-yellow-600">
                                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                            </svg>
                                            <span class="font-medium">Waiting for freelancer signature</span>
                                        </div>
                                    }
                                    <p class="text-sm text-gray-600 mt-1">
                                        Created on @(ViewBag.ContractCreatedAt != null ? ((DateTime)ViewBag.ContractCreatedAt).ToString("MMM dd, yyyy") : "Unknown")
                                    </p>
                                </div>
                            }
                        }

                        @if (ViewBag.ContractStatus == "Terminated")
                        {

                        }
                        else if (ViewBag.ContractStatus == "Completed")
                        {
                            <div class="grid gap-2 mb-4 grid-cols-2">
                                <div class="col-span-2 sm:col-span-1">
                                    <div class="flex justify-center">
                                        <a href="@Url.Action("Details", "Contract", new { id = ViewBag.ContractId })" class="text-white inline-flex items-center justify-center bg-gray-800 hover:bg-gray-900 focus:outline-none focus:ring-4 focus:ring-gray-300 font-medium rounded-lg text-sm px-5 py-3 me-2 text-center mt-4 w-full">
                                            <svg fill="#ffffff" viewBox="-3.5 0 19 19" xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-1">
                                                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                                                <g id="SVGRepo_iconCarrier">
                                                    <path d="m11.235 10.34-.01.015-2.077 3.599a.913.913 0 0 1-.713.411H3.577a.913.913 0 0 1-.713-.411L.765 10.319a.47.47 0 0 1 .022-.595l.127-.099.019-.015c1.966-1.547 3.204-4.239 3.569-7.405v-.263a.475.475 0 0 1 .944-.072v7.14a1.425 1.425 0 1 0 1.109.008V1.875a.475.475 0 0 1 .945.067v.273c.366 3.177 1.59 5.876 3.57 7.418l.143.112a.47.47 0 0 1 .022.594zm-.727 5.46a.464.464 0 0 0-.463-.462H1.944a.463.463 0 0 0-.462.462v1.142a.463.463 0 0 0 .462.462h8.101a.464.464 0 0 0 .463-.462z"></path>
                                                </g>
                                            </svg>
                                            View Contract
                                        </a>
                                    </div>
                                </div>
                                <div class="col-span-2 sm:col-span-1">
                                    <div class="flex justify-center">
                                        <a href="@Url.Action("Index", "Deliverable", new { id = ViewBag.ContractId })" class="text-white inline-flex items-center justify-center bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-3 me-2 text-center mt-4 w-full">
                                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-1">
                                                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                                                <g id="SVGRepo_iconCarrier">
                                                    <path d="M13 3L13.7071 2.29289C13.5196 2.10536 13.2652 2 13 2V3ZM19 9H20C20 8.73478 19.8946 8.48043 19.7071 8.29289L19 9ZM13.109 8.45399L14 8V8L13.109 8.45399ZM13.546 8.89101L14 8L13.546 8.89101ZM10 13C10 12.4477 9.55228 12 9 12C8.44772 12 8 12.4477 8 13H10ZM8 16C8 16.5523 8.44772 17 9 17C9.55228 17 10 16.5523 10 16H8ZM8.5 9C7.94772 9 7.5 9.44772 7.5 10C7.5 10.5523 7.94772 11 8.5 11V9ZM9.5 11C10.0523 11 10.5 10.5523 10.5 10C10.5 9.44772 10.0523 9 9.5 9V11ZM8.5 6C7.94772 6 7.5 6.44772 7.5 7C7.5 7.55228 7.94772 8 8.5 8V6ZM9.5 8C10.0523 8 10.5 7.55228 10.5 7C10.5 6.44772 10.0523 6 9.5 6V8ZM17.908 20.782L17.454 19.891L17.454 19.891L17.908 20.782ZM18.782 19.908L19.673 20.362L18.782 19.908ZM5.21799 19.908L4.32698 20.362H4.32698L5.21799 19.908ZM6.09202 20.782L6.54601 19.891L6.54601 19.891L6.09202 20.782ZM6.09202 3.21799L5.63803 2.32698L5.63803 2.32698L6.09202 3.21799ZM5.21799 4.09202L4.32698 3.63803L4.32698 3.63803L5.21799 4.09202ZM12 3V7.4H14V3H12ZM14.6 10H19V8H14.6V10ZM12 7.4C12 7.66353 11.9992 7.92131 12.0169 8.13823C12.0356 8.36682 12.0797 8.63656 12.218 8.90798L14 8C14.0293 8.05751 14.0189 8.08028 14.0103 7.97537C14.0008 7.85878 14 7.69653 14 7.4H12ZM14.6 8C14.3035 8 14.1412 7.99922 14.0246 7.9897C13.9197 7.98113 13.9425 7.9707 14 8L13.092 9.78201C13.3634 9.92031 13.6332 9.96438 13.8618 9.98305C14.0787 10.0008 14.3365 10 14.6 10V8ZM12.218 8.90798C12.4097 9.2843 12.7157 9.59027 13.092 9.78201L14 8V8L12.218 8.90798ZM8 13V16H10V13H8ZM8.5 11H9.5V9H8.5V11ZM8.5 8H9.5V6H8.5V8ZM13 2H8.2V4H13V2ZM4 6.2V17.8H6V6.2H4ZM8.2 22H15.8V20H8.2V22ZM20 17.8V9H18V17.8H20ZM19.7071 8.29289L13.7071 2.29289L12.2929 3.70711L18.2929 9.70711L19.7071 8.29289ZM15.8 22C16.3436 22 16.8114 22.0008 17.195 21.9694C17.5904 21.9371 17.9836 21.8658 18.362 21.673L17.454 19.891C17.4045 19.9162 17.3038 19.9539 17.0322 19.9761C16.7488 19.9992 16.3766 20 15.8 20V22ZM18 17.8C18 18.3766 17.9992 18.7488 17.9761 19.0322C17.9539 19.3038 17.9162 19.4045 17.891 19.454L19.673 20.362C19.8658 19.9836 19.9371 19.5904 19.9694 19.195C20.0008 18.8114 20 18.3436 20 17.8H18ZM18.362 21.673C18.9265 21.3854 19.3854 20.9265 19.673 20.362L17.891 19.454C17.7951 19.6422 17.6422 19.7951 17.454 19.891L18.362 21.673ZM4 17.8C4 18.3436 3.99922 18.8114 4.03057 19.195C4.06287 19.5904 4.13419 19.9836 4.32698 20.362L6.10899 19.454C6.0838 19.4045 6.04612 19.3038 6.02393 19.0322C6.00078 18.7488 6 18.3766 6 17.8H4ZM8.2 20C7.62345 20 7.25117 19.9992 6.96784 19.9761C6.69617 19.9539 6.59545 19.9162 6.54601 19.891L5.63803 21.673C6.01641 21.8658 6.40963 21.9371 6.80497 21.9694C7.18864 22.0008 7.65645 22 8.2 22V20ZM4.32698 20.362C4.6146 20.9265 5.07354 21.3854 5.63803 21.673L6.54601 19.891C6.35785 19.7951 6.20487 19.6422 6.10899 19.454L4.32698 20.362ZM8.2 2C7.65645 2 7.18864 1.99922 6.80497 2.03057C6.40963 2.06287 6.01641 2.13419 5.63803 2.32698L6.54601 4.10899C6.59545 4.0838 6.69617 4.04612 6.96784 4.02393C7.25117 4.00078 7.62345 4 8.2 4V2ZM6 6.2C6 5.62345 6.00078 5.25117 6.02393 4.96784C6.04612 4.69617 6.0838 4.59545 6.10899 4.54601L4.32698 3.63803C4.13419 4.01641 4.06287 4.40963 4.03057 4.80497C3.99922 5.18864 4 5.65645 4 6.2H6ZM5.63803 2.32698C5.07354 2.6146 4.6146 3.07354 4.32698 3.63803L6.10899 4.54601C6.20487 4.35785 6.35785 4.20487 6.54601 4.10899L5.63803 2.32698Z" fill="#ffffff"></path>
                                                </g>
                                            </svg>
                                            Deliverables
                                        </a>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex justify-center">
                                <a href="@Url.Action("Feedback", "ManageProjectClient", new { id = ViewBag.AcceptBidId })" class="text-white inline-flex items-center justify-center focus:outline-none bg-green-700 hover:bg-green-800 focus:ring-4 focus:ring-green-300 font-medium rounded-lg text-sm px-5 py-3 me-2 mb-2 text-center mt-2 w-full">
                                    <svg viewBox="0 -18 1060 1060" fill="#ffffff" class="w-4 h-4 mr-1" version="1.1" xmlns="http://www.w3.org/2000/svg" stroke="#ffffff" stroke-width="21.2">
                                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                                        <g id="SVGRepo_iconCarrier">
                                            <path d="M963.2 408c-13.6 0-24 11.2-24 24v432c0 27.2-21.6 48.8-48.8 48.8H159.2c-27.2 0-48.8-21.6-48.8-48.8V159.2c0-27.2 21.6-48.8 48.8-48.8h470.4c13.6 0 24-11.2 24-24 0-13.6-11.2-24-24-24H154.4C103.2 62.4 61.6 104 61.6 155.2v715.2c0 51.2 41.6 92.8 92.8 92.8h740.8c51.2 0 92.8-41.6 92.8-92.8V432c0-12.8-11.2-24-24.8-24z" fill=""></path><path d="M968 151.2l-44-44c-30.4-30.4-78.4-33.6-105.6-5.6L355.2 564.8 510.4 720l463.2-463.2c28-27.2 25.6-75.2-5.6-105.6z m-116.8 159.2l-344 344-86.4-85.6 345.6-345.6 84.8 87.2z m88-88l-51.2 51.2-85.6-86.4 50.4-50.4c10.4-10.4 28.8-9.6 40 2.4l44 44c12 10.4 12.8 28.8 2.4 39.2zM355.2 566.4l-48 174.4c-2.4 8 0 16 5.6 21.6 5.6 5.6 13.6 8 21.6 5.6l174.4-48-36-36L360 715.2l31.2-113.6-36-35.2z" fill=""></path>
                                        </g>
                                    </svg>
                                    Feedback
                                </a>
                            </div>
                        }
                        else
                        {
                            <div class="flex justify-center">
                                @if (ViewBag.ContractId == null)
                                {
                                    <!-- No contract exists - show Create Contract button -->
                                    <a href="@Url.Action("Create", "Contract", new { projectId = Model.ProjectId })" class="text-white inline-flex items-center justify-center bg-gray-800 hover:bg-gray-900 focus:outline-none focus:ring-4 focus:ring-gray-300 font-medium rounded-lg text-sm px-5 py-3 me-2 text-center mt-4 w-full">
                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                        </svg>
                                        Create Contract
                                    </a>
                                }
                                else
                                {
                                    <!-- Contract exists - show appropriate action based on status -->
                                    @if (ViewBag.NeedsSignature == true)
                                    {
                                        <!-- Client needs to sign -->
                                        <a href="@Url.Action("Sign", "Contract", new { id = ViewBag.ContractId })" class="text-white inline-flex items-center justify-center bg-gray-800 hover:bg-gray-900 focus:outline-none focus:ring-4 focus:ring-gray-300 font-medium rounded-lg text-sm px-5 py-3 me-2 text-center mt-4 w-full">
                                            <svg fill="#ffffff" viewBox="-3.5 0 19 19" xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-1">
                                                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                                                <g id="SVGRepo_iconCarrier">
                                                    <path d="m11.235 10.34-.01.015-2.077 3.599a.913.913 0 0 1-.713.411H3.577a.913.913 0 0 1-.713-.411L.765 10.319a.47.47 0 0 1 .022-.595l.127-.099.019-.015c1.966-1.547 3.204-4.239 3.569-7.405v-.263a.475.475 0 0 1 .944-.072v7.14a1.425 1.425 0 1 0 1.109.008V1.875a.475.475 0 0 1 .945.067v.273c.366 3.177 1.59 5.876 3.57 7.418l.143.112a.47.47 0 0 1 .022.594zm-.727 5.46a.464.464 0 0 0-.463-.462H1.944a.463.463 0 0 0-.462.462v1.142a.463.463 0 0 0 .462.462h8.101a.464.464 0 0 0 .463-.462z"></path>
                                                </g>
                                            </svg>
                                            Sign Contract
                                        </a>
                                    }
                                    else if (ViewBag.ContractStatus == "Active")
                                    {
                                        <!-- Contract is active - show manage button -->
                                        <a href="@Url.Action("Details", "Contract", new { id = ViewBag.ContractId })" class="text-white inline-flex items-center justify-center bg-gray-800 hover:bg-gray-900 focus:outline-none focus:ring-4 focus:ring-gray-300 font-medium rounded-lg text-sm px-5 py-3 me-2 text-center mt-4 w-full">
                                            <svg fill="#ffffff" viewBox="-3.5 0 19 19" xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-1">
                                                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                                                <g id="SVGRepo_iconCarrier">
                                                    <path d="m11.235 10.34-.01.015-2.077 3.599a.913.913 0 0 1-.713.411H3.577a.913.913 0 0 1-.713-.411L.765 10.319a.47.47 0 0 1 .022-.595l.127-.099.019-.015c1.966-1.547 3.204-4.239 3.569-7.405v-.263a.475.475 0 0 1 .944-.072v7.14a1.425 1.425 0 1 0 1.109.008V1.875a.475.475 0 0 1 .945.067v.273c.366 3.177 1.59 5.876 3.57 7.418l.143.112a.47.47 0 0 1 .022.594zm-.727 5.46a.464.464 0 0 0-.463-.462H1.944a.463.463 0 0 0-.462.462v1.142a.463.463 0 0 0 .462.462h8.101a.464.464 0 0 0 .463-.462z"></path>
                                                </g>
                                            </svg>
                                            Manage Contract
                                        </a>
                                    }
                                    else
                                    {
                                        <!-- Contract exists but pending freelancer signature -->
                                        <a href="@Url.Action("Details", "Contract", new { id = ViewBag.ContractId })" class="text-white inline-flex items-center justify-center bg-gray-800 hover:bg-gray-900 focus:outline-none focus:ring-4 focus:ring-gray-300 font-medium rounded-lg text-sm px-5 py-3 me-2 text-center mt-4 w-full">
                                            <svg fill="#ffffff" viewBox="-3.5 0 19 19" xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-1">
                                                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                                                <g id="SVGRepo_iconCarrier">
                                                    <path d="m11.235 10.34-.01.015-2.077 3.599a.913.913 0 0 1-.713.411H3.577a.913.913 0 0 1-.713-.411L.765 10.319a.47.47 0 0 1 .022-.595l.127-.099.019-.015c1.966-1.547 3.204-4.239 3.569-7.405v-.263a.475.475 0 0 1 .944-.072v7.14a1.425 1.425 0 1 0 1.109.008V1.875a.475.475 0 0 1 .945.067v.273c.366 3.177 1.59 5.876 3.57 7.418l.143.112a.47.47 0 0 1 .022.594zm-.727 5.46a.464.464 0 0 0-.463-.462H1.944a.463.463 0 0 0-.462.462v1.142a.463.463 0 0 0 .462.462h8.101a.464.464 0 0 0 .463-.462z"></path>
                                                </g>
                                            </svg>
                                            Pending Freelancer
                                        </a>
                                    }
                                }
                            </div>
                            <div class="flex justify-center">
                                @if (ViewBag.ContractId == null || ViewBag.ContractStatus != "Active")
                                {
                                    <a class="text-white inline-flex items-center justify-center bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-3 me-2 mb-2 text-center mt-4 w-full opacity-50 cursor-not-allowed">
                                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-1">
                                            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                                            <g id="SVGRepo_iconCarrier">
                                                <path d="M13 3L13.7071 2.29289C13.5196 2.10536 13.2652 2 13 2V3ZM19 9H20C20 8.73478 19.8946 8.48043 19.7071 8.29289L19 9ZM13.109 8.45399L14 8V8L13.109 8.45399ZM13.546 8.89101L14 8L13.546 8.89101ZM10 13C10 12.4477 9.55228 12 9 12C8.44772 12 8 12.4477 8 13H10ZM8 16C8 16.5523 8.44772 17 9 17C9.55228 17 10 16.5523 10 16H8ZM8.5 9C7.94772 9 7.5 9.44772 7.5 10C7.5 10.5523 7.94772 11 8.5 11V9ZM9.5 11C10.0523 11 10.5 10.5523 10.5 10C10.5 9.44772 10.0523 9 9.5 9V11ZM8.5 6C7.94772 6 7.5 6.44772 7.5 7C7.5 7.55228 7.94772 8 8.5 8V6ZM9.5 8C10.0523 8 10.5 7.55228 10.5 7C10.5 6.44772 10.0523 6 9.5 6V8ZM17.908 20.782L17.454 19.891L17.454 19.891L17.908 20.782ZM18.782 19.908L19.673 20.362L18.782 19.908ZM5.21799 19.908L4.32698 20.362H4.32698L5.21799 19.908ZM6.09202 20.782L6.54601 19.891L6.54601 19.891L6.09202 20.782ZM6.09202 3.21799L5.63803 2.32698L5.63803 2.32698L6.09202 3.21799ZM5.21799 4.09202L4.32698 3.63803L4.32698 3.63803L5.21799 4.09202ZM12 3V7.4H14V3H12ZM14.6 10H19V8H14.6V10ZM12 7.4C12 7.66353 11.9992 7.92131 12.0169 8.13823C12.0356 8.36682 12.0797 8.63656 12.218 8.90798L14 8C14.0293 8.05751 14.0189 8.08028 14.0103 7.97537C14.0008 7.85878 14 7.69653 14 7.4H12ZM14.6 8C14.3035 8 14.1412 7.99922 14.0246 7.9897C13.9197 7.98113 13.9425 7.9707 14 8L13.092 9.78201C13.3634 9.92031 13.6332 9.96438 13.8618 9.98305C14.0787 10.0008 14.3365 10 14.6 10V8ZM12.218 8.90798C12.4097 9.2843 12.7157 9.59027 13.092 9.78201L14 8V8L12.218 8.90798ZM8 13V16H10V13H8ZM8.5 11H9.5V9H8.5V11ZM8.5 8H9.5V6H8.5V8ZM13 2H8.2V4H13V2ZM4 6.2V17.8H6V6.2H4ZM8.2 22H15.8V20H8.2V22ZM20 17.8V9H18V17.8H20ZM19.7071 8.29289L13.7071 2.29289L12.2929 3.70711L18.2929 9.70711L19.7071 8.29289ZM15.8 22C16.3436 22 16.8114 22.0008 17.195 21.9694C17.5904 21.9371 17.9836 21.8658 18.362 21.673L17.454 19.891C17.4045 19.9162 17.3038 19.9539 17.0322 19.9761C16.7488 19.9992 16.3766 20 15.8 20V22ZM18 17.8C18 18.3766 17.9992 18.7488 17.9761 19.0322C17.9539 19.3038 17.9162 19.4045 17.891 19.454L19.673 20.362C19.8658 19.9836 19.9371 19.5904 19.9694 19.195C20.0008 18.8114 20 18.3436 20 17.8H18ZM18.362 21.673C18.9265 21.3854 19.3854 20.9265 19.673 20.362L17.891 19.454C17.7951 19.6422 17.6422 19.7951 17.454 19.891L18.362 21.673ZM4 17.8C4 18.3436 3.99922 18.8114 4.03057 19.195C4.06287 19.5904 4.13419 19.9836 4.32698 20.362L6.10899 19.454C6.0838 19.4045 6.04612 19.3038 6.02393 19.0322C6.00078 18.7488 6 18.3766 6 17.8H4ZM8.2 20C7.62345 20 7.25117 19.9992 6.96784 19.9761C6.69617 19.9539 6.59545 19.9162 6.54601 19.891L5.63803 21.673C6.01641 21.8658 6.40963 21.9371 6.80497 21.9694C7.18864 22.0008 7.65645 22 8.2 22V20ZM4.32698 20.362C4.6146 20.9265 5.07354 21.3854 5.63803 21.673L6.54601 19.891C6.35785 19.7951 6.20487 19.6422 6.10899 19.454L4.32698 20.362ZM8.2 2C7.65645 2 7.18864 1.99922 6.80497 2.03057C6.40963 2.06287 6.01641 2.13419 5.63803 2.32698L6.54601 4.10899C6.59545 4.0838 6.69617 4.04612 6.96784 4.02393C7.25117 4.00078 7.62345 4 8.2 4V2ZM6 6.2C6 5.62345 6.00078 5.25117 6.02393 4.96784C6.04612 4.69617 6.0838 4.59545 6.10899 4.54601L4.32698 3.63803C4.13419 4.01641 4.06287 4.40963 4.03057 4.80497C3.99922 5.18864 4 5.65645 4 6.2H6ZM5.63803 2.32698C5.07354 2.6146 4.6146 3.07354 4.32698 3.63803L6.10899 4.54601C6.20487 4.35785 6.35785 4.20487 6.54601 4.10899L5.63803 2.32698Z" fill="#ffffff"></path>
                                            </g>
                                        </svg>
                                        View Deliverables
                                        <span class="ml-2 text-xs italic">(Contract Required)</span>
                                    </a>
                                }
                                else
                                {
                                    <a href="@Url.Action("Index", "Deliverable", new { id = ViewBag.ContractId })" class="text-white inline-flex items-center justify-center bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-3 me-2 mb-2 text-center mt-4 w-full">
                                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-1">
                                            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                                            <g id="SVGRepo_iconCarrier">
                                                <path d="M13 3L13.7071 2.29289C13.5196 2.10536 13.2652 2 13 2V3ZM19 9H20C20 8.73478 19.8946 8.48043 19.7071 8.29289L19 9ZM13.109 8.45399L14 8V8L13.109 8.45399ZM13.546 8.89101L14 8L13.546 8.89101ZM10 13C10 12.4477 9.55228 12 9 12C8.44772 12 8 12.4477 8 13H10ZM8 16C8 16.5523 8.44772 17 9 17C9.55228 17 10 16.5523 10 16H8ZM8.5 9C7.94772 9 7.5 9.44772 7.5 10C7.5 10.5523 7.94772 11 8.5 11V9ZM9.5 11C10.0523 11 10.5 10.5523 10.5 10C10.5 9.44772 10.0523 9 9.5 9V11ZM8.5 6C7.94772 6 7.5 6.44772 7.5 7C7.5 7.55228 7.94772 8 8.5 8V6ZM9.5 8C10.0523 8 10.5 7.55228 10.5 7C10.5 6.44772 10.0523 6 9.5 6V8ZM17.908 20.782L17.454 19.891L17.454 19.891L17.908 20.782ZM18.782 19.908L19.673 20.362L18.782 19.908ZM5.21799 19.908L4.32698 20.362H4.32698L5.21799 19.908ZM6.09202 20.782L6.54601 19.891L6.54601 19.891L6.09202 20.782ZM6.09202 3.21799L5.63803 2.32698L5.63803 2.32698L6.09202 3.21799ZM5.21799 4.09202L4.32698 3.63803L4.32698 3.63803L5.21799 4.09202ZM12 3V7.4H14V3H12ZM14.6 10H19V8H14.6V10ZM12 7.4C12 7.66353 11.9992 7.92131 12.0169 8.13823C12.0356 8.36682 12.0797 8.63656 12.218 8.90798L14 8C14.0293 8.05751 14.0189 8.08028 14.0103 7.97537C14.0008 7.85878 14 7.69653 14 7.4H12ZM14.6 8C14.3035 8 14.1412 7.99922 14.0246 7.9897C13.9197 7.98113 13.9425 7.9707 14 8L13.092 9.78201C13.3634 9.92031 13.6332 9.96438 13.8618 9.98305C14.0787 10.0008 14.3365 10 14.6 10V8ZM12.218 8.90798C12.4097 9.2843 12.7157 9.59027 13.092 9.78201L14 8V8L12.218 8.90798ZM8 13V16H10V13H8ZM8.5 11H9.5V9H8.5V11ZM8.5 8H9.5V6H8.5V8ZM13 2H8.2V4H13V2ZM4 6.2V17.8H6V6.2H4ZM8.2 22H15.8V20H8.2V22ZM20 17.8V9H18V17.8H20ZM19.7071 8.29289L13.7071 2.29289L12.2929 3.70711L18.2929 9.70711L19.7071 8.29289ZM15.8 22C16.3436 22 16.8114 22.0008 17.195 21.9694C17.5904 21.9371 17.9836 21.8658 18.362 21.673L17.454 19.891C17.4045 19.9162 17.3038 19.9539 17.0322 19.9761C16.7488 19.9992 16.3766 20 15.8 20V22ZM18 17.8C18 18.3766 17.9992 18.7488 17.9761 19.0322C17.9539 19.3038 17.9162 19.4045 17.891 19.454L19.673 20.362C19.8658 19.9836 19.9371 19.5904 19.9694 19.195C20.0008 18.8114 20 18.3436 20 17.8H18ZM18.362 21.673C18.9265 21.3854 19.3854 20.9265 19.673 20.362L17.891 19.454C17.7951 19.6422 17.6422 19.7951 17.454 19.891L18.362 21.673ZM4 17.8C4 18.3436 3.99922 18.8114 4.03057 19.195C4.06287 19.5904 4.13419 19.9836 4.32698 20.362L6.10899 19.454C6.0838 19.4045 6.04612 19.3038 6.02393 19.0322C6.00078 18.7488 6 18.3766 6 17.8H4ZM8.2 20C7.62345 20 7.25117 19.9992 6.96784 19.9761C6.69617 19.9539 6.59545 19.9162 6.54601 19.891L5.63803 21.673C6.01641 21.8658 6.40963 21.9371 6.80497 21.9694C7.18864 22.0008 7.65645 22 8.2 22V20ZM4.32698 20.362C4.6146 20.9265 5.07354 21.3854 5.63803 21.673L6.54601 19.891C6.35785 19.7951 6.20487 19.6422 6.10899 19.454L4.32698 20.362ZM8.2 2C7.65645 2 7.18864 1.99922 6.80497 2.03057C6.40963 2.06287 6.01641 2.13419 5.63803 2.32698L6.54601 4.10899C6.59545 4.0838 6.69617 4.04612 6.96784 4.02393C7.25117 4.00078 7.62345 4 8.2 4V2ZM6 6.2C6 5.62345 6.00078 5.25117 6.02393 4.96784C6.04612 4.69617 6.0838 4.59545 6.10899 4.54601L4.32698 3.63803C4.13419 4.01641 4.06287 4.40963 4.03057 4.80497C3.99922 5.18864 4 5.65645 4 6.2H6ZM5.63803 2.32698C5.07354 2.6146 4.6146 3.07354 4.32698 3.63803L6.10899 4.54601C6.20487 4.35785 6.35785 4.20487 6.54601 4.10899L5.63803 2.32698Z" fill="#ffffff"></path>
                                            </g>
                                        </svg>
                                        View Deliverables
                                    </a>
                                }
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="profileModal" class="fixed inset-0 flex items-center justify-center z-50 hidden" style="background-color: rgba(0, 0, 0, 0.5); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);">
    <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-full mx-4">
        <div class="relative p-6">
            <button type="button" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 rounded-full p-2 hover:bg-gray-100 transition-colors duration-200" onclick="closeProfileModal()">
                <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
            <div class="flex flex-col md:flex-row items-start space-y-4 md:space-y-0 md:space-x-6">
                <!-- Profile Picture -->
                <div class="flex-shrink-0">
                    @if (!string.IsNullOrEmpty(Model.FreelancerPhoto))
                    {
                        <img src="@Model.FreelancerPhoto" alt="Profile Picture" class="w-32 h-32 rounded-full object-cover border-4 border-gray-200 shadow-lg">
                    }
                    else
                    {
                        <img src="https://ik.imagekit.io/6txj3mofs/GIGHub%20(11).png?updatedAt=1750552804497" alt="Default Profile Picture" class="w-32 h-32 rounded-full object-cover border-4 border-gray-200 shadow-lg">
                    }
                </div>

                <!-- Profile Information -->
                <div class="flex-1 min-w-0">
                    <h3 class="text-2xl font-bold text-gray-900 mb-2">@Model.FreelancerName</h3>

                    @if (!string.IsNullOrEmpty(Model.FreelancerEmail))
                    {
                        <div class="flex items-center mb-2">
                            <svg class="w-5 h-5 text-gray-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                            </svg>
                            <span class="text-gray-700">@Model.FreelancerEmail</span>
                        </div>
                    }

                    @if (!string.IsNullOrEmpty(Model.FreelancerUsername))
                    {
                        <div class="flex items-center mb-2">
                            <svg class="w-5 h-5 text-gray-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"></path>
                            </svg>
                            <span class="text-gray-700">@Model.FreelancerUsername</span>
                        </div>
                    }

                    @if (Model.FreelancerSkills.Any())
                    {
                        <div class="mt-4">
                            <h4 class="text-lg font-semibold text-gray-900 mb-2">Skills</h4>
                            <div class="flex flex-wrap gap-2">
                                @foreach (var skill in Model.FreelancerSkills)
                                {
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
                                        @skill.Name
                                    </span>
                                }
                            </div>
                        </div>
                    }

                    <!-- Action Buttons -->
                    <div class="flex flex-wrap gap-3 mt-6">
                        @await Html.PartialAsync("_ChatButton", Model.FreelancerId)
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function openProfileModal() {
        document.getElementById('profileModal').classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }

    function closeProfileModal() {
        document.getElementById('profileModal').classList.add('hidden');
        document.body.style.overflow = 'auto';
    }

    // Close profile modal when clicking outside the modal
    document.getElementById('profileModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeProfileModal();
        }
    });

    // Close modals with Escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeProfileModal();
        }
    });
</script>